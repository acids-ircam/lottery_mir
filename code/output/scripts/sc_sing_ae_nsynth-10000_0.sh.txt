#!/bin/bash
#SBATCH --gres=gpu:v100l:1            # Request GPU generic resources
#SBATCH --cpus-per-task=6   # Cores proportional to GPUs: 6 on Cedar, 16 on Graham.
#SBATCH --mem=32000M        # Memory proportional to GPUs: 32000 Cedar, 64000 Graham.
#SBATCH --time=0-23:59
#SBATCH --output=output/out_sing_ae_nsynth-10000_0

module load python/3.7
virtualenv --no-download $SLURM_TMPDIR/env
source $SLURM_TMPDIR/env/bin/activate
pip install --no-index --upgrade pip
pip install --no-index -r requirements.txt
pip install ~/scratch/python_libs/nnAudio-0.1.0-py3-none-any.whl
pip install ~/scratch/python_libs/SoundFile-0.10.3.post1-py2.py3-none-any.whl
pip install ~/scratch/python_libs/resampy-0.2.2.tar.gz
pip install ~/scratch/python_libs/librosa-0.7.2.tar.gz
pip install ~/scratch/python_libs/lmdb-0.98.tar.gz
cd $SLURM_TMPDIR

cd /scratch/esling/lottery/
python main.py --device cuda --datadir /scratch/esling/datasets/ --output /scratch/esling/output/ --dataset nsynth-10000 --model sing_ae --epochs 160 --prune trimming --prune_reset reinit --prune_scope local --prune_selection magnitude --prune_percent 22 --warm_latent 100 --prune_it 15 --kernel 5 --n_layers 4 --channels 64 --encoder_dims 16 --rewind_it 80 --eval_interval 70 --n_hidden 512 --k_run 0
