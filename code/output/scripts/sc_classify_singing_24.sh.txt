#!/bin/bash
#SBATCH --gres=gpu:v100l:1            # Request GPU generic resources
#SBATCH --cpus-per-task=6   # Cores proportional to GPUs: 6 on Cedar, 16 on Graham.
#SBATCH --mem=32000M        # Memory proportional to GPUs: 32000 Cedar, 64000 Graham.
#SBATCH --time=0-23:59
#SBATCH --output=output/out_classify_singing_24

module load python/3.7
virtualenv --no-download $SLURM_TMPDIR/env
source $SLURM_TMPDIR/env/bin/activate
pip install --no-index --upgrade pip
pip install --no-index -r requirements.txt
pip install ~/scratch/python_libs/nnAudio-0.1.0-py3-none-any.whl
pip install ~/scratch/python_libs/SoundFile-0.10.3.post1-py2.py3-none-any.whl
pip install ~/scratch/python_libs/resampy-0.2.2.tar.gz
pip install ~/scratch/python_libs/librosa-0.7.2.tar.gz
pip install ~/scratch/python_libs/lmdb-0.98.tar.gz
pip install ~/scratch/python_libs/mir_eval-0.6.tar.gz
cd $SLURM_TMPDIR

cd /scratch/esling/lottery/
python main.py --device cuda --datadir /scratch/esling/datasets/ --output /home/esling/scratch/output_mir --dataset singing --model classify --epochs 160 --prune masking --prune_reset reinit --prune_scope local --prune_selection magnitude --prune_percent 30 --warm_latent 100 --lr 0.0001 --prune_it 15 --rewind_it 60 --n_hidden 512 --n_layers 3 --channels 64 --kernel 256 --encoder_dims 16 --eval_interval 70 --k_run 0
